<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equal Loudness Contours</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
            background: linear-gradient(90deg, #00f5ff, #00a8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1em;
        }
        
        .phon-explanation {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 245, 255, 0.3);
        }
        
        .phon-explanation strong {
            color: #00f5ff;
        }
        
        .chart-container {
            position: relative;
            background: #0f1419;
            border-radius: 15px;
            padding: 40px 20px 70px 80px;
            border: 2px solid rgba(0, 245, 255, 0.2);
            margin-bottom: 30px;
        }
        
        .chart-area {
            position: relative;
            height: 600px;
            border-left: 3px solid rgba(255, 255, 255, 0.4);
            border-bottom: 3px solid rgba(255, 255, 255, 0.4);
        }
        
        .y-axis-label {
            position: absolute;
            left: -85px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
            white-space: nowrap;
        }
        
        .x-axis-label {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
        }
        
        .y-markers {
            position: absolute;
            left: -40px;
            top: 0;
            height: 100%;
        }
        
        .y-marker {
            position: absolute;
            right: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .x-markers {
            position: absolute;
            bottom: -40px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
        }
        
        .x-marker {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            transform: translateX(-50%);
        }
        
        .grid-line-h {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .grid-line-v {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(255, 255, 255, 0.08);
        }
        
        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        
        .curve {
            fill: none;
            stroke-width: 2.5;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .curve.inactive {
            stroke: rgba(100, 100, 100, 0.3) !important;
            stroke-width: 2;
        }
        
        .curve.active {
            stroke-width: 4;
            filter: drop-shadow(0 0 8px currentColor);
        }
        
        .curve-label {
            font-size: 13px;
            font-weight: bold;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }
        
        .curve-label.inactive {
            fill: rgba(150, 150, 150, 0.5);
        }
        
        .instruction {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            font-style: italic;
            margin-top: 15px;
            margin-bottom: 20px;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .legend-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }
        
        .legend-line {
            width: 30px;
            height: 4px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .legend-item.inactive .legend-line {
            opacity: 0.3;
        }
        
        .legend-text {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }
        
        .legend-item.inactive .legend-text {
            opacity: 0.4;
        }
        
        .legend-item.active {
            background: rgba(0, 245, 255, 0.1);
        }
        
        .legend-item.active .legend-line {
            box-shadow: 0 0 8px currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Equal Loudness Contours (ISO 226:2003)</h1>
        <div class="subtitle">Calculated Using Actual ISO 226 Algorithm</div>
        
        <div class="phon-explanation">
            <strong>What is a Phon?</strong> A phon is a unit of perceived loudness. At 1 kHz, phons equal dB SPL (e.g., 40 dB SPL at 1 kHz = 40 phons). Each curve shows the SPL needed at different frequencies to sound equally loud.
        </div>
        
        <div class="chart-container">
            <div class="y-axis-label">Sound Pressure Level (dB SPL)</div>
            <div class="x-axis-label">Frequency (Hz)</div>
            
            <div class="chart-area" id="chartArea">
                <div class="y-markers">
                    <div class="y-marker" style="top: 0%;">120</div>
                    <div class="y-marker" style="top: 8.33%;">110</div>
                    <div class="y-marker" style="top: 16.66%;">100</div>
                    <div class="y-marker" style="top: 25%;">90</div>
                    <div class="y-marker" style="top: 33.33%;">80</div>
                    <div class="y-marker" style="top: 41.66%;">70</div>
                    <div class="y-marker" style="top: 50%;">60</div>
                    <div class="y-marker" style="top: 58.33%;">50</div>
                    <div class="y-marker" style="top: 66.66%;">40</div>
                    <div class="y-marker" style="top: 75%;">30</div>
                    <div class="y-marker" style="top: 83.33%;">20</div>
                    <div class="y-marker" style="top: 91.66%;">10</div>
                    <div class="y-marker" style="top: 100%;">0</div>
                </div>
                
                <div class="x-markers" id="xMarkers"></div>
                
                <!-- Grid lines -->
                <div class="grid-line-h" style="top: 8.33%;"></div>
                <div class="grid-line-h" style="top: 16.66%;"></div>
                <div class="grid-line-h" style="top: 25%;"></div>
                <div class="grid-line-h" style="top: 33.33%;"></div>
                <div class="grid-line-h" style="top: 41.66%;"></div>
                <div class="grid-line-h" style="top: 50%;"></div>
                <div class="grid-line-h" style="top: 58.33%;"></div>
                <div class="grid-line-h" style="top: 66.66%;"></div>
                <div class="grid-line-h" style="top: 75%;"></div>
                <div class="grid-line-h" style="top: 83.33%;"></div>
                <div class="grid-line-h" style="top: 91.66%;"></div>
                
                <svg id="curveSvg" viewBox="0 0 1000 600" preserveAspectRatio="none">
                </svg>
            </div>
        </div>
        
        <div class="instruction">
            Hover over any curve or legend item to highlight it. Calculated using the actual ISO 226:2003 standard equations.
        </div>
        
        <div class="legend" id="legend"></div>
    </div>
    
    <script>
        // ISO 226:2003 reference data (29 frequencies from 20Hz to 12.5kHz)
        const isoData = {
            freq: [20, 25, 31.5, 40, 50, 63, 80, 100, 125, 160, 200, 250, 315, 400, 500, 630, 800, 1000, 1250, 1600, 2000, 2500, 3150, 4000, 5000, 6300, 8000, 10000, 12500],
            af: [0.532, 0.506, 0.480, 0.455, 0.432, 0.409, 0.387, 0.367, 0.349, 0.330, 0.315, 0.301, 0.288, 0.276, 0.267, 0.259, 0.253, 0.250, 0.246, 0.244, 0.243, 0.243, 0.243, 0.242, 0.242, 0.245, 0.254, 0.271, 0.301],
            Lu: [-31.6, -27.2, -23.0, -19.1, -15.9, -13.0, -10.3, -8.1, -6.2, -4.5, -3.1, -2.0, -1.1, -0.4, 0.0, 0.3, 0.5, 0.0, -2.7, -4.1, -1.0, 1.7, 2.5, 1.2, -2.1, -7.1, -11.2, -10.7, -3.1],
            Tf: [78.5, 68.7, 59.5, 51.1, 44.0, 37.5, 31.5, 26.5, 22.1, 17.9, 14.4, 11.4, 8.6, 6.2, 4.4, 3.0, 2.2, 2.4, 3.5, 1.7, -1.3, -4.2, -6.0, -5.4, -1.5, 6.0, 12.6, 13.9, 12.3]
        };
        
        // ISO 226:2003 calculation
        function calculateSPL(phon, freq, af, Lu, Tf) {
            const Ln = phon;
            const Bf = Math.pow(0.4 * Math.pow(10, ((Tf + Lu) / 10 - 9)), af);
            const Af = 4.47e-3 * (Math.pow(10, 0.025 * Ln) - 1.15) + Bf;
            const Lp = (10 / af) * Math.log10(Af) - Lu + 94;
            return Lp;
        }
        
        // Generate curves
        const phonLevels = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
        const colors = ['#ff0066', '#ff3366', '#ff6b35', '#ff9900', '#ffaa00', '#ffcc00', '#ffd700', '#c0ff00', '#00ff88', '#00d4ff', '#0088ff'];
        
        const svg = document.getElementById('curveSvg');
        const legend = document.getElementById('legend');
        
        // Calculate frequency to x position (logarithmic scale)
        function freqToX(freq) {
            const minFreq = Math.log10(20);
            const maxFreq = Math.log10(12500);
            return ((Math.log10(freq) - minFreq) / (maxFreq - minFreq)) * 1000;
        }
        
        // SPL to y position (0-120 dB range, inverted)
        function splToY(spl) {
            return 600 - (spl / 120) * 600;
        }
        
        // Generate curves
        phonLevels.forEach((phon, idx) => {
            const points = [];
            
            for (let i = 0; i < isoData.freq.length; i++) {
                const spl = calculateSPL(phon, isoData.freq[i], isoData.af[i], isoData.Lu[i], isoData.Tf[i]);
                const x = freqToX(isoData.freq[i]);
                const y = splToY(spl);
                points.push({x, y, spl});
            }
            
            // Create smooth path
            let pathData = `M ${points[0].x},${points[0].y}`;
            for (let i = 1; i < points.length; i++) {
                pathData += ` L ${points[i].x},${points[i].y}`;
            }
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', colors[idx]);
            path.setAttribute('class', phon === 80 ? 'curve active' : 'curve' + (phon !== 80 ? ' inactive' : ''));
            path.setAttribute('data-phon', phon);
            svg.appendChild(path);
            
            // Add label
            const lastPoint = points[points.length - 1];
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', 50);
            text.setAttribute('y', points[0].y + 10);
            text.setAttribute('fill', colors[idx]);
            text.setAttribute('class', phon === 80 ? 'curve-label' : 'curve-label' + (phon !== 80 ? ' inactive' : ''));
            text.setAttribute('data-phon', phon);
            text.textContent = phon;
            svg.appendChild(text);
            
            // Add to legend
            const legendItem = document.createElement('div');
            legendItem.className = phon === 80 ? 'legend-item active' : 'legend-item' + (phon !== 80 ? ' inactive' : '');
            legendItem.setAttribute('data-phon', phon);
            legendItem.innerHTML = `
                <div class="legend-line" style="background: ${colors[idx]};"></div>
                <span class="legend-text">${phon}</span>
            `;
            legend.appendChild(legendItem);
        });
        
        // Generate x-axis markers
        const freqMarkers = [20, 50, 100, 200, 500, 1000, 2000, 5000, 10000];
        const xMarkersDiv = document.getElementById('xMarkers');
        freqMarkers.forEach(freq => {
            const x = (freqToX(freq) / 1000) * 100;
            const marker = document.createElement('div');
            marker.className = 'x-marker';
            marker.style.left = x + '%';
            marker.textContent = freq >= 1000 ? (freq/1000) + 'k' : freq;
            xMarkersDiv.appendChild(marker);
        });
        
        // Interaction
        const curves = document.querySelectorAll('.curve');
        const labels = document.querySelectorAll('.curve-label');
        const legendItems = document.querySelectorAll('.legend-item');
        
        let activePhon = '80';
        
        function setActiveCurve(phonValue) {
            activePhon = phonValue;
            
            curves.forEach(curve => {
                if (curve.dataset.phon === phonValue) {
                    curve.classList.remove('inactive');
                    curve.classList.add('active');
                } else {
                    curve.classList.add('inactive');
                    curve.classList.remove('active');
                }
            });
            
            labels.forEach(label => {
                if (label.dataset.phon === phonValue) {
                    label.classList.remove('inactive');
                } else {
                    label.classList.add('inactive');
                }
            });
            
            legendItems.forEach(item => {
                if (item.dataset.phon === phonValue) {
                    item.classList.remove('inactive');
                    item.classList.add('active');
                } else {
                    item.classList.add('inactive');
                    item.classList.remove('active');
                }
            });
        }
        
        curves.forEach(curve => {
            curve.addEventListener('mouseenter', () => setActiveCurve(curve.dataset.phon));
        });
        
        labels.forEach(label => {
            label.addEventListener('mouseenter', () => setActiveCurve(label.dataset.phon));
        });
        
        legendItems.forEach(item => {
            item.addEventListener('mouseenter', () => setActiveCurve(item.dataset.phon));
            item.addEventListener('click', () => setActiveCurve(item.dataset.phon));
        });
        
        document.querySelector('.chart-area').addEventListener('mouseleave', () => setActiveCurve('80'));
    </script>
</body>
</html>
